readlines("snp.tsv.gz", n=2)
readLines("snp.tsv.gz", n=2)
readLines("snp.tsv.gz", n=2)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info",
"1000Gp3_AF"
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
desired_columns_indel
str_replace_all(desired_columns_indel, "`", "")
library(stringr)
str_replace_all(desired_columns_indel, "`", "")
cleaned_desired <- str_replace_all(desired_columns_indel, "`", "")
all(cleaned_desired %in% all_fields)
all_fields <- get_fields("indel.tsv.gz")
all(cleaned_desired %in% all_fields)
all_fields %>% select_(.dots = desired_columns)
library(tidyverse)
all_fields %>% select_(.dots = desired_columns)
desired_columns
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns, to_split, verbose = TRUE)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
all_fields
desired_column
desired_columns
desired_columns
readLines("snp.tsv.gz", n=2)
# list all fields in an annotation file:
(all_fields <- get_fields("snp.tsv.gz"))
# list all fields in an annotation file:
get_fields("snp.tsv.gz")
desired_columns <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
# "CADDphred",
"CADD_phred", #NOTE: different than the indel annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info",
"1000Gp3_AF"
)
to_split <-
c(
"VEP_ensembl_Consequence",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
desired_columns <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
# "CADDphred",
"CADD_phred", #NOTE: different than the indel annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info",
"1000Gp3_AF"
)
to_split <-
c(
"VEP_ensembl_Consequence",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info",
"1000Gp3_AF"
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"1000Gp3_AF",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"`1000Gp3_AF`",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
readLines("parsed_indel.tsv", n=2)
# list all fields in an annotation file:
get_fields("parsed_indel.tsv")
readLines("parsed_indel.tsv", n=1)
setwd("/home/staff/bheavner/projects/variant_work/my_packages/wgsaparsr")
devtools::load_all()
devtools::load_all()
setwd("~/projects/topmed_workshop_2017_bh")
desired_columns <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
# "CADDphred",
"CADD_phred", #NOTE: different than the indel annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info",
"1000Gp3_AF"
)
to_split <-
c(
"VEP_ensembl_Consequence",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"`1000Gp3_AF`",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
readLines("snp.tsv.gz", n=2)
header <- readLines("snp.tsv.gz", n=1)
str_split(header, "\t")[[1]][[1]] != "#chr")
str_split(header, "\t")[[1]][[1]] != "#chr"
str_split(header, "\t")[[1]][[1]]
str_split(header, "\t")[[1]][[1]]
setwd("/home/staff/bheavner/projects/variant_work/my_packages/wgsaparsr")
devtools::load_all()
setwd("~/projects/topmed_workshop_2017_bh")
get_fields(snp.tsv.gz)
get_fields("snp.tsv.gz"")
;
""
get_fields("snp.tsv.gz")
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"`1000Gp3_AF`",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
q()
# list all fields in an annotation file:
get_fields("parsed_indel.tsv")
setwd("/home/staff/bheavner/projects/variant_work/my_packages/wgsaparsr")
devtools::load_all()
setwd("~/projects/topmed_workshop_2017_bh")
get_fields("snp.tsv.gz"")
""
get_fields("snp.tsv.gz")
desired_columns_indel
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"1000Gp3_AF",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
desired_columns_indel
class(desired_columns_indel[[7]])
source_file = "indel.tsv.gz"
desired_columns <- desired_columns_indel
.has_header <- function(raw_chunk){
any(str_sub(raw_chunk, 1, 4) == "#chr")
}
readfile_con <- gzfile(source_file, "r")
raw_chunk <- suppressWarnings(readLines(readfile_con, n = 5))
.has_header(raw_chunk)
raw_header <- raw_chunk[str_sub(raw_chunk, 1, 4) == "#chr"]
all_fields <-
read_tsv(paste0(raw_chunk, collapse = "\n"),
#paste all lines to a single string
col_types = cols(.default = col_character()))
header_flag <- TRUE
all_fields
all_fields %>%
select_(.dots = desired_columns)
desired_columns
View(all_fields)
glimpse(all_fields)
desired_columns
all_fields %>%
select_(.dots = desired_columns)
all_fields %>%
select_(.dots = as.name(desired_columns))
all_fields %>%
select_(.dots = desired_columns)
as.name(desired_columns)
desired_columns
cleaned_desired <- str_replace_all(desired_columns, "`", "")
as.name(cleaned_desired)
cleaned_desired
1000Gp3_AF
setwd("/home/staff/bheavner/projects/variant_work/my_packages/wgsaparsr")
devtools::load_all()
setwd("~/projects/topmed_workshop_2017_bh")
get_fields("snp.tsv.gz")
desired_columns <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
# "CADDphred",
"CADD_phred", #NOTE: different than the indel annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
# "1000Gp3_AF" #skipped for the workshop because code doesn't work with this variable name
)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
# "1000Gp3_AF"#skipped for the workshop because code doesn't work with this variable name
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
readLines("parsed_indel.tsv", n=2)
# list all fields in an annotation file:
get_fields("parsed_indel.tsv")
get_fields("indel.tsv.gz")
get_fields("parsed_indel.tsv")
get_fields("indel.tsv.gz")
readLines("parsed_indel.tsv", n=2)
get_fields("snp.tsv.gz")
get_fields("indel.tsv.gz")
desired_columns_indel <-
c(
"#chr",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
# "1000Gp3_AF"#skipped for the workshop because code doesn't work with this variable name
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
desired_columns <-
c(
"#chr",
"pos",
"ref",
"alt",
"rs_dbSNP147",
# "CADDphred",
"CADD_phred", #NOTE: different than the indel annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
# "1000Gp3_AF" #skipped for the workshop because code doesn't work with this variable name
)
to_split <-
c(
"VEP_ensembl_Consequence",
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
)
desired_columns_indel <-
c(
"#chr",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
# "1000Gp3_AF"#skipped for the workshop because code doesn't work with this variable name
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
setwd("/home/staff/bheavner/projects/variant_work/my_packages/wgsaparsr")
devtools::load_all()
setwd("~/projects/topmed_workshop_2017_bh")
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
# "1000Gp3_AF"#skipped for the workshop because code doesn't work with this variable name
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
desired_columns_indel <-
c(
"`#chr`",
"pos",
"ref",
"alt",
"rs_dbSNP147",
"CADDphred",
#  "CADD_phred", #NOTE: different than the general annotation file.
"VEP_ensembl_Transcript_ID",
"VEP_ensembl_Gene_Name",
"VEP_ensembl_Gene_ID",
"VEP_ensembl_Consequence",
"VEP_ensembl_Amino_Acid_Change",
"VEP_ensembl_LoF",
"VEP_ensembl_LoF_filter",
"VEP_ensembl_LoF_flags",
"VEP_ensembl_LoF_info"
# "1000Gp3_AF"#skipped for the workshop because code doesn't work with this variable name
)
parse_indel_to_file("indel.tsv.gz", "parsed_indel.tsv", desired_columns_indel, to_split, verbose = TRUE)
readLines("parsed_indel.tsv", n=2)
readLines("parsed_indel.tsv", n=2)
q()
